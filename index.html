Option Strict Off
Option Explicit On
Friend Class frmDefaultTranCodes
    Inherits System.Windows.Forms.Form
    Dim rsDftTran As New VBtoRecordSet()
    Dim frmDefaulTranMaint As New frmDefaulTranMaint
    Public varTableKey As Object
    Dim strCode As String
    Dim strTranCode As String
    Dim strDescription As String
    Dim intRequired As Short

    Public Shared Function GetColumnIndex(ByVal dataGrid As DataGridView, ByVal ColumnName As String) As Integer
        Dim i As Integer
        Dim ColumnIndex As Integer = -1
        For i = 0 To dataGrid.Columns.Count - 1
            If dataGrid.Columns(i).Name.ToUpper = ColumnName.ToUpper Then
                ColumnIndex = i
                Exit For
            End If
        Next
        Return ColumnIndex
    End Function


    Private Sub Command1_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles Command1.Click
        Dim Index As Short = Command1.GetIndex(eventSender)
        Dim aTranCodes() As ValidTranCodes
        Dim sSql As String = String.Empty
        Dim No As New Integer
        Dim Yes As New Integer
        Dim rowIndex As Short
        '		fpLstDftTran.ColFromName = "CODE"
        'UPGRADE_WARNING: Couldn't resolve default property of object varTableKey. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="6A50421D-15FE-4896-8A1B-2EC21E9037B2"'
        varTableKey = fpLstDftTran.SelectedCells(GetColumnIndex(fpLstDftTran, fpLstDftTran.Columns(0).Name)).Value

        Select Case Index

            Case 0 'New
                Dim frmDefaulTranMaint As New frmDefaulTranMaint
                frmDefaulTranMaint.Tag = "NEW"
                frmDefaulTranMaint.Text = "Default Trancodes Add"
                frmDefaulTranMaint.ShowDialog()
                Me.Visible = True
                strCode = String.Empty
                strCode = CStr(0)
                strDescription = String.Empty
                intRequired = 0
                fpLstDftTran.Update()

                'Me.Visible = True
                'strCode = String.Empty
                'strTranCode = CStr(0)
                'strDescription = String.Empty
                'intRequired = 0
                'fpLstDftTran.Update()

            Case 1 'Edit
                If fpLstDftTran.SelectedRows.Count = 0 Then
                    MsgBox("You must select a Trancode to edit", MsgBoxStyle.Information, "Default Trancode Information")
                    fpLstDftTran.Focus()
                    Exit Sub
                End If
                rowIndex = fpLstDftTran.CurrentRow.Index
                fpLstDftTran_Click(fpLstDftTran, New System.EventArgs())
                'frmDefaulTranMaint.frmDefaulTranMaint_Load(eventSender, New System.EventArgs)
                frmDefaulTranMaint.Tag = "EDIT"
                frmDefaulTranMaint.Text = String.Empty
                frmDefaulTranMaint.Text = "Default Trancodes Edit"
                GetTranCodes(frmDefaulTranMaint.cboDftTran, "", "", aTranCodes)


                frmDefaulTranMaint.Text1(0).Text = strCode
                frmDefaulTranMaint.Text1(0).Enabled = False
                frmDefaulTranMaint.Text1(1).Text = strDescription
                If Trim(strTranCode) = String.Empty Then
                    frmDefaulTranMaint.cboDftTran.SelectedIndex = frmDefaulTranMaint.cboDftTran.Items.Count - 1
                Else
                    SelectListIndex(strTranCode, frmDefaulTranMaint.cboDftTran)
                    frmDefaulTranMaint.cboDftTran.SelectedIndex = gsindex
                End If
                frmDefaulTranMaint.cboRequired.Items.Clear()
                frmDefaulTranMaint.cboRequired.Items.Add("No")
                frmDefaulTranMaint.cboRequired.Items.Add("Yes")
                If intRequired = 0 Then
                    SelectListIndex("No", (frmDefaulTranMaint.cboRequired))
                    'frmDefaulTranMaint.cboRequired.ListIndex = 0
                Else
                    SelectListIndex("Yes", (frmDefaulTranMaint.cboRequired))
                    'frmDefaulTranMaint.cboRequired.ListIndex = 1
                End If

                frmDefaulTranMaint.ShowDialog()
                Me.Visible = True

                If Me.Tag = "CANCEL" Then
                    frmDefaulTranMaint.Text1(0).Text = String.Empty
                    frmDefaulTranMaint.Text1(1).Text = String.Empty
                    frmDefaulTranMaint.Text1(1).Text = String.Empty
                    frmDefaulTranMaint.cboRequired.Items.Clear()
                    frmDefaulTranMaint.cboDftTran.Items.Clear()
                    'strCode = String.Empty
                    'strTranCode = String.Empty
                    'strDescription = String.Empty
                    'intRequired = 0
                    'frmDefaulTranMaint.Close()
                    'Me.strCode = String.Empty
                End If

            Case 2 'Delete

                'UPGRADE_WARNING: Couldn't resolve default property of object varTableKey. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="6A50421D-15FE-4896-8A1B-2EC21E9037B2"'
                If MsgBox("Are you sure you want to delete default code " & varTableKey, MsgBoxStyle.YesNo, Me.Text) = MsgBoxResult.Yes Then

                    ''Settinp up Where clause
                    'UPGRADE_WARNING: Couldn't resolve default property of object varTableKey. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="6A50421D-15FE-4896-8A1B-2EC21E9037B2"'
                    sSql = "CODE = '" & varTableKey & "'"
                    ''Deleting rs
                    'DBBeginTran()
                    rowIndex = fpLstDftTran.CurrentRow.Index
                    DBDeleteRec("DFTTRAN", sSql)
                    'DBCommit()
                    sSql = String.Empty

                End If

            Case 3 'Cancel
                Me.Hide()
                MessageBox.Show("PLEASE NOTE : For changes to settings to take effect Users must exist and restart the application", _
            "System Management", _
                 MessageBoxButtons.OK, _
                MessageBoxIcon.Information, _
                MessageBoxDefaultButton.Button1)
                Me.Close()
                'UPGRADE_WARNING: Screen property Screen.MousePointer has a new behavior. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="6BA9B8D2-2A32-4B6E-8D36-44949974A5B4"'
                System.Windows.Forms.Cursor.Current = System.Windows.Forms.Cursors.Default
                'ShowWarn()
                Exit Sub
            Case 4 'close
                System.Windows.Forms.Cursor.Current = System.Windows.Forms.Cursors.Default
                MessageBox.Show("closing")

        End Select

        ''Reload the spread
        LoadfpLstDftTran()
        If (rowIndex > 0) Then
            fpLstDftTran.Rows(rowIndex).Selected = True
        End If

    End Sub
    Private Sub frmDefaultTranCodes_Load(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles MyBase.Load
        Dim sSql As String = String.Empty
        LoadfpLstDftTran()

    End Sub

    Private Sub frmDefaultTranCodes_FormClosed(ByVal eventSender As System.Object, ByVal eventArgs As System.Windows.Forms.FormClosedEventArgs) Handles Me.FormClosed

        PutfpListColWidth(Me.Name, fpLstDftTran, "")

    End Sub

    Private Sub fpLstDftTran_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles fpLstDftTran.Click
        If CheckWin7Version = True Then
            'SpreadListEvent(fpLstDftTran, 4)
        End If

        strCode = fpLstDftTran.SelectedCells(GetColumnIndex(fpLstDftTran, fpLstDftTran.Columns(0).Name)).Value
        '		fpLstDftTran.ColFr  omName = "TRANCODE"
        strTranCode = fpLstDftTran.SelectedCells(GetColumnIndex(fpLstDftTran, fpLstDftTran.Columns(1).Name)).Value
        '		fpLstDftTran.ColFromName = "DESC1"
        strDescription = fpLstDftTran.SelectedCells(GetColumnIndex(fpLstDftTran, fpLstDftTran.Columns(2).Name)).Value
        '		fpLstDftTran.ColFromName = "REQUIRED"
        intRequired = fpLstDftTran.SelectedCells(GetColumnIndex(fpLstDftTran, fpLstDftTran.Columns(3).Name)).Value


    End Sub

    Public Sub LoadfpLstDftTran()

        Dim sSql As String
        Dim intI As Short
        Dim rsDftTran As New VBtoRecordSet()
        'GetfpListColWidth(Me.Name, fpLstDftTran, "")

        ''Opening rs to fill spread
        ' sSql = "SELECT CODE as Code ,DESC1 as Description ,REQUIRED as Required, TRANCODE as Trancode FROM DFTTRAN ORDER BY CODE"
        ' Select ACTIONCODE as [Action Code] , ACTDESC as Description from ACTIONCODES
        sSql = "SELECT CODE as Code , TRANCODE as  Trancode, DESC1 as Description , REQUIRED as Required FROM DFTTRAN ORDER BY CODE"
        rsDftTran.OpenRecordset(sSql, ADODB.CursorTypeEnum.adOpenForwardOnly, ADODB.LockTypeEnum.adLockReadOnly)
        fpLstDftTran.DataSource = rsDftTran.Table
        fpLstDftTran.Columns(0).Width = 100
        fpLstDftTran.Columns(1).Width = 100
        fpLstDftTran.Columns(2).Width = 150
        fpLstDftTran.Columns(3).Width = 150
        fpLstDftTran.Columns("TRANCODE").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
        fpLstDftTran.Columns("REQUIRED").DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
        'fpLstDftTran.DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
        'fpLstDftTran.Columns(3).DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter
        'fpLstDftTran.Columns(1).AutoSizeMode

        intI = 0
        Do Until rsDftTran.EOF
            intI = fpLstDftTran.Rows.Count
            Dim col As Integer = GetColumnIndex(fpLstDftTran, "CODE")
            ' fpLstDftTran.ColFromName = "CODE"
            Dim row As Integer
            ' row = fpLstDftTran.SelectedRows(0).ToString
            'fpLstDftTran.set_ColList(rsDftTran.Fields(0).Value)

            Dim col1 As Integer = GetColumnIndex(fpLstDftTran, "TRANCODE")
            ' fpLstDftTran.ColFromName = "TRANCODE"
            ' fpLstDftTran.set_ColList(rsDftTran.Fields(1).Value)

            Dim col2 As Integer = GetColumnIndex(fpLstDftTran, "DESC1")
            'fpLstDftTran.ColFromName = "DESC1"
            'fpLstDftTran.set_ColList(rsDftTran.Fields(2).Value)

            Dim col3 As Integer = GetColumnIndex(fpLstDftTran, "REQUIRED")
            'fpLstDftTran.ColFromName = "REQUIRED"
            'fpLstDftTran.set_ColList(rsDftTran.Fields(3).Value)
            rsDftTran.MoveNext()
            intI = intI + 1
        Loop
        rsDftTran.MoveFirst()

    End Sub


    'Private Sub fpLstDftTran_DataBindingComplete(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles fpLstDftTran.DataBindingComplete

    '    'LoadfpLstDftTran()

    '    'If CheckWin7Version() = True Then
    '    'SpreadListEvent(fpLstDftTran, 4)
    '    ' End If
    'End Sub

    Private Sub fpLstDftTran_DoubleClick(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles fpLstDftTran.DoubleClick
        Command1_Click(Command1.Item(1), New System.EventArgs())
    End Sub
End Class

